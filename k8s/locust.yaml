apiVersion: v1
kind: ConfigMap
metadata:
  name: locust-script
data:
  locustfile.py: |-
    from locust import HttpUser, task, between
    
    class QuickstartUser(HttpUser):
    wait_time = between(0.7, 1.3)

    @task
    def hello_world(self):
        self.client.get("/", headers={"Host": "raisethefox.com"})
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: locust-script
template:
  metadata:
    labels:
      app: locust
  spec:
    containers:
      - name: locust
        image: locustio/locust
        ports:
          - containerPort: 8089
        volumeMounts:
          - name:  locust-script
            mountPath:  /home/locust
    volumes:
      - name:  locust-script
        configMap:
          name: locust-script   
---
apiVersion: v1
kind: Service
metadata:
  name:  locust
spec:
  selector:
    app:  locust
  type:  LoadBalancer
  ports:
    - port:  8089
      targetPort:  8089
        

