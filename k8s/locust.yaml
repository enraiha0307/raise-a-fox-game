apiVersion: v1
kind: ConfigMap
metadata:
  name: locust-script
data:
  locustfile.py: |-
    from locust import HttpUser, task, between
    
    class QuickstartUser(HttpUser):
    wait_time = between(0.7, 1.3)

    @task
    def hello_world(self):
        self.client.get("/", headers={"Host": "raisethefox.com"})
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: locust-deployment
  labels:
    app: locust-app
spec:
  selector:
    matchLabels:
      app: locust-app
  template:
    metadata:
      labels:
        app: locust-app
    spec:
      containers:
      - image: locustio/locust
        name: locust
        ports:
        - containerPort: 8089
        volumeMounts:
        - mountPath: /home/locust
          name: locust-script
        resources:
         limits:
           memory: 2000Mi
           cpu: "2"
         requests:
           memory: 1000Mi
           cpu: "1"
      volumes:
      - configMap:
        name: locust-script
---
apiVersion: v1
kind: Service
metadata:
  name:  locust-service
spec:
  selector:
    app:  locust-app
  type:  LoadBalancer
  ports:
    - port:  8089
      targetPort:  8089
        

